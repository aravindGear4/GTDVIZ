<html>
<head>
  <meta charset="UTF-8">
  <!-- external libraries-->
  <script src="./lib/jquery311.js" type="application/javascript"></script>
  <script src="./lib/d3.js"></script>
  <script>
  var d3_v4=d3;
  var store="Aravind stored";
  </script>
  <link rel="stylesheet" href="./css/main.css" type="text/css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="./lib/parallel-coordinates-master/d3.parcoords.js"></script>
  <link rel="stylesheet" type="text/css" href="./lib/parallel-coordinates-master/d3.parcoords.css"></link>
  <script src="./lib/noUiSlider-master/distribute/nouislider.js"></script>
  <script src="./lib/underscore.math/underscore.js"></script>
  <script src="./lib/underscore.math/underscore.math.js"></script>
  <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
    <!--slick grid-->
  <link rel="stylesheet" href="./lib/SlickGrid-2.3.2/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="./lib/SlickGrid-2.3.2/css/smoothness/jquery-ui-1.11.3.custom.css" type="text/css"/>
  <script src="./lib/SlickGrid-2.3.2/lib/jquery-1.11.2.min.js"></script>
  <script src="./lib/SlickGrid-2.3.2/lib/jquery.event.drag-2.3.0.js"></script>
  <script src="./lib/SlickGrid-2.3.2/slick.core.js"></script>
  <script src="./lib/SlickGrid-2.3.2/slick.grid.js"></script>
  <script src="./lib/SlickGrid-2.3.2/slick.dataview.js"></script>
  <script src="./lib/topojson.js"></script>
  <script src="https://d3js.org/d3-color.v1.min.js"></script>
  <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>

  <!--JS files-->
  <script src="./js/worldMapVis.js"></script>
  <script src="./js/detailsView.js"></script>
  <script src="./js/slider.js"></script>
  <script src="./js/parallelCords.js"></script>
  <script src="./js/drop_down.js"></script>
  <script src="./js/animate.js"></script>
  <script src="./js/colorHelper.js"></script>
</head>

<body onload="init()">
  <div class="container-fluid">
    <div class="row">
      <h4>Title</h4>
    </div>
    <div class="row">
      <div id="leftpane" class="col-sm-3">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <label >Attribute:<label>
            </div>
            <div class="col-sm-6">
              <select id="select-list">
                <option id ='org'>Organization</option>
                <option id='attack'>Attack Type</option>
                <option id='weapon'>Weapon Type</option>
                <option id='target'>Target Type</option>
              </select>
            </div>

            <div id="selectedAttribute" name="dropdown" style="height:20%;overflow:scroll" class="col-sm-12">
              <table id="tableid" class="scrollTable">
                <tr>
                  <td></td>
                  <td></td>
                </tr>
              </table>
            </div>
            <div id="noUiSlider" class="col-sm-12"></div>
            <input type="year" id="startyr" value=2015 class="col-sm-3"></input>
            <input type="year" id="endyr" value=2016 class="col-sm-3"></input>
            <button id='playbut' onclick="play()" class="col-sm-3">Play!</button>
            <select id="timeinterval" class="col-sm-3"></select>
            <div id="detailsTable" class="col-sm-12" style="height:33%"></div>
          </div>
        </div>
      </div>
      <div class="col-sm-8">
        <div id="rightpan" class="col-sm-8">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-12">
                <div id="worldMap" style="height:38%;width:180%"></div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="container-fluid">
                  <div id="gtdParacords" class="parcoords" style="height:33%;width:180%;padding-left:3%"></div>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div> <!--right pan-->
      </div>
      <div class="row">
        <div id="themeriver" class="themeriver" style="width:95%;height:23%">Themeriver<br/></div>
      </div>
    </div>
  </div>
<script>
//add the drop drop_down
$('#timeinterval').html("");
for(var i=1;i<=10;i++){
  $('#timeinterval').html($('#timeinterval').html()+"<option value="+i+">"+i+"</option>")
}
addDropDownList();
addSlider();

//updateParallelCordsEvents();
//updatePrallelCords();
updateThemeRiver();
function updateThemeRiver(){
  $("document").ready(function(){
    $.ajax({
        url: 'getDatayr',
        type:"GET",
        dataType: "json",
        data: {
          startyr:$('#startyr').val(),
          endyr:$('#endyr').val()
        },
        success: function(data) {
          regData=convertJsonTo2dArray(data);
          themeriver(regData);
        },
    });
  });
  //end
}
function convertJsonTo2dArray(data)
{
  var uniqueContinents={};
  for(var i=0;i<data.length;i++)
  {
    //TODO if we dont want this much data then only get only those data that is needed
    data[i]['key']=data[i]._id.continent;
    uniqueContinents[data[i]._id.continent]=true;
    data[i]['date']=data[i]._id.year;
    delete data[i]['_id'];
    delete data[i]['nkill'];
    delete data[i]['nperps'];
    delete data[i]['nkillter'];
    delete data[i]['nwound'];
    //delete data[i]['__proto__'];
  }
  updateEntity(uniqueContinents);
 // console.log(data);
  assigneddata=assignmissing(data);
  return assigneddata;
}

function assignmissing(dataset)
{
  var defaultValue=0;
  var keys = ["Australasia & Oceania","Central America & Caribbean","Central Asia","East Asia","Eastern Europe","Middle East & North Africa","North America","South America","South Asia","Southeast Asia","Sub-Saharan Africa","Western Europe"];
    var newData = [];
    var sortByDate = function(a,b){ return a.date > b.date ? 1 : -1; };
    dataset.sort(sortByDate);
    var sortByName = function(a,b){
      if((a.key >= b.key) && (a.date>=b.date)){ return 1; }
      else {return -1;}
    };
    var startingyear = dataset[0].date;
    dataset.sort(sortByName);
    console.log("Fixing missing data");
    var iyear=startingyear;
    var j=0;
   dataset.forEach(function(row){
      //console.log(row.key);
      //console.log(keys[j]);
      while(row.key!=keys[j]){
        newData.push( { key: keys[j],
          value: +defaultValue,
          date: iyear })
        j=j+1;
        if(j==12){
          j=0;
          iyear=iyear+1;
        }
      }
      j=j+1;
      if(j==12){
        j=0;
        iyear=iyear+1;
      }
    });
    console.log("Fixed Missing data");
    return dataset.concat(newData).sort(sortByDate);
}
</script>
</body>
</html>
