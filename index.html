<html>
<head>
  <meta charset="UTF-8">
  <script src="./lib/jquery311.js" type="application/javascript"></script>
  <script src="./lib/d3.js"></script>
  <script>
  var d3_v4=d3;
  var store="Aravind stored";
  </script>
  <!-- external libraries-->
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="./lib/parallel-coordinates-master/d3.parcoords.js"></script>
  <link rel="stylesheet" type="text/css" href="./lib/parallel-coordinates-master/d3.parcoords.css"></link>
  <script src="./lib/noUiSlider-master/distribute/nouislider.js"></script>
    <!--slick grid-->
  <link rel="stylesheet" href="./lib/SlickGrid-2.3.2/slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="./lib/SlickGrid-2.3.2/css/smoothness/jquery-ui-1.11.3.custom.css" type="text/css"/>
  <script src="./lib/SlickGrid-2.3.2/lib/jquery-1.11.2.min.js"></script>
  <script src="./lib/SlickGrid-2.3.2/lib/jquery.event.drag-2.3.0.js"></script>

  <script src="./lib/SlickGrid-2.3.2/slick.core.js"></script>
  <script src="./lib/SlickGrid-2.3.2/slick.grid.js"></script>
  <script src="./lib/SlickGrid-2.3.2/slick.dataview.js"></script>

  <!--JS files-->
  <script src="./lib/topojson.js"></script>
  <script src="./js/worldMapVis.js"></script>
  <script src="./js/detailsView.js"></script>
  <script src="./js/slider.js"></script>
  <script src="./js/parallelCords.js"></script>
  <script src="./js/drop_down.js"></script>
  <script src="./js/animate.js"></script>
</head>
<style type="text/css">
  body {
  font: 10px sans-serif;
}
.themeriver {
  background: #fff;
}
p {
  font: 12px helvetica;
}
.axis path, .axis line {
  fill: none;
  stroke: #000;
  stroke-width: 2px;
  shape-rendering: crispEdges;
}

#vis {
        background: black;
      }
circle {
  fill: rgba(255, 255, 255, 0.2);
}
</style>
<body onload="init()"> <!-- init() defined in coffee.js-->
  Attribute: <select id="select-list">
  <option id ='org'>Organization</option>
  <option id='attack'>Attack Type</option>
  <option id='weapon'>Weapon Type</option>
  <option id='target'>Target Type</option>
 </select>
 <br>
 <pre id='selectedAttribute'></pre>
 <br>
  <div id="noUiSlider" style="width:200px;height:15px"></div>
   Start Year:
   <!--TODO change this to label, else update the slider based on the input value-->
   <input type="year" id="startyr" value=2015></input>
   <br>
   End Year:
   <input type="year" id="endyr" value=2016></input>
   <br><br>
   <button id='playbut' onclick="play()">Play!</button>
   <select id="timeinterval"></select>
    <div id="vis"></div>
    <pre id='res'></pre><!--
    Organisation<br/>
    <div id="organisation" class="parcoords" style="width:1000px;height:220px"></div>
    Country<br/>
    <div id="country" class="parcoords" style="width:1000px;height:220px"></div>-->
    <div id="gtdParacords" class="parcoords" style="height:400px"></div>
    <div id="detailsTable" style="width:1000px;height:220px"></div>
    <div id="themeriver" class="themeriver" style="width:1000px;height:220px">Themeriver<br/></div>
<script>
//add the drop drop_down
$('#timeinterval').html("");
for(var i=1;i<=10;i++){
  $('#timeinterval').html($('#timeinterval').html()+"<option value="+i+">"+i+"</option>")
}
addDropDownList();
addSlider();
//updateParallelCordsEvents();
//updatePrallelCords();
//aggregatedata by region
$("document").ready(function(){
  $.ajax({
      url: 'getDatayr',
      type:"GET",
      dataType: "json",
      data: {
        startyr:$('#startyr').val(),
        endyr:$('#endyr').val()
      },
      success: function(data) {
        regData=convertJsonTo2dArray(data);
        themeriver(regData);
      },
  });
});
//end
function convertJsonTo2dArray(data)
{
  for(var i=0;i<data.length;i++)
  {
    //TODO if we dont want this much data then only get only those data that is needed
    data[i]['key']=data[i]._id.continent;
    data[i]['date']=data[i]._id.year;
    delete data[i]['_id'];
    delete data[i]['nkill'];
    delete data[i]['nperps'];
    delete data[i]['nkillter'];
    delete data[i]['nwound'];
    //delete data[i]['__proto__'];
  }
 // console.log(data);
  assigneddata=assignmissing(data);
  return assigneddata;
}

function assignmissing(dataset)
{
  var defaultValue=0;
  var keys = ["Australasia & Oceania","Central America & Caribbean","Central Asia","East Asia","Eastern Europe","Middle East & North Africa","North America","South America","South Asia","Southeast Asia","Sub-Saharan Africa","Western Europe"];
    var newData = [];
    var sortByDate = function(a,b){ return a.date > b.date ? 1 : -1; };
    dataset.sort(sortByDate);
    var sortByName = function(a,b){
      if((a.key >= b.key) && (a.date>=b.date)){ return 1; }
      else {return -1;}
    };
    var startingyear = dataset[0].date;
    dataset.sort(sortByName);
    console.log("Fixing missing data");
    var iyear=startingyear;
    var j=0;
   dataset.forEach(function(row){
      //console.log(row.key);
      //console.log(keys[j]);
      while(row.key!=keys[j]){
                 newData.push( { key: keys[j],
                         value: +defaultValue,
                         date: iyear })
                 j=j+1;
       if(j==12){
        j=0;
        iyear=iyear+1;
   }

    }
                 j=j+1;
       if(j==12){
        j=0;
        iyear=iyear+1;
   }
  });
    console.log("Fixed Missing data");
    return dataset.concat(newData).sort(sortByDate);
}
</script>
</body>
</html>
